name: BU-deploy-front

on:
  push:
    branches:
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:

      - name: git pull on server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USERNAME }}
          password: ${{ secrets.SERVER_PASSWORD }}
          # port: ${{ secrets.PORT }}
          script: |
            cd www 
            cd ${{ secrets.FOLDER_DEV }} 
            git config --global user.email "1@php-cat.com" 
            git config --global user.name "Sergey" 
            git fetch --all 
            git reset --hard origin/dev
          
      # - name: laravel migrate
      #   uses: appleboy/ssh-action@master
      #   with:
      #     host: ${{ secrets.SERVER_IP }}
      #     username: ${{ secrets.SERVER_USERNAME }}
      #     password: ${{ secrets.SERVER_PASSWORD }}
      #     script: cd www && cd ${{ secrets.FOLDER }} && /opt/php74/bin/php artisan migrate

      - name: setup composer pacs on server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USERNAME }}
          password: ${{ secrets.SERVER_PASSWORD }}
          script: |
            cd www 
            cd ${{ secrets.FOLDER_DEV }} 
            /opt/php74/bin/php ./composer.phar i 
            /opt/php74/bin/php artisan migrate
            

      - name: setup npm
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USERNAME }}
          password: ${{ secrets.SERVER_PASSWORD }}
          script: |
            cd www
            cd ${{ secrets.FOLDER_DEV }} 
            npm i 
            npm run dev
          # script: cd www && cd ${{ secrets.FOLDER }} && npm i && npm run dev

      - name: send telega
        uses: appleboy/telegram-action@master
        with:
          # to: ${{ secrets.TELEGRAM_TO }}
          to: 360209578, phpcat, 
          # 5152088168, serhio
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            +++ –ø—É–ª–ª –≤ —Ä–µ–ø—É bu_dev +++
            üë®üèª‚Äçüíª ${{github.actor}} –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ${{ github.repository }}
            —Å–¥–µ–ª–∞–ª ${{ github.event_name }}. –∑–∞–¥–∞–Ω–∏–µ ${{github.job}}.
            